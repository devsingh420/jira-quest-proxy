<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>âš”ï¸ Jira Quest â€” BUM Board</title>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:#1a1c2c; color:#f4f4f4; font-family:monospace; min-height:100vh; padding:10px 12px; }
    button { cursor:pointer; font-family:monospace; }
    canvas { border-radius:8px; border:2px solid #4a4e8c; width:100%; height:auto; cursor:pointer; }
    .header { display:flex; align-items:center; justify-content:space-between; margin-bottom:10px; padding:8px 14px; background:#16213e; border-radius:8px; border:2px solid #f0c040; box-shadow:0 0 20px #f0c04033; }
    .tabs { display:flex; gap:4px; margin-bottom:10px; flex-wrap:wrap; }
    .tab { background:#16213e; color:#566c86; border:1px solid #4a4e8c; border-radius:6px; padding:5px 10px; font-size:11px; font-weight:bold; }
    .tab.active { background:#f0c040; color:#1a1c2c; border-color:#f0c040; }
    .panel { background:#16213e; border:2px solid #4a4e8c; border-radius:8px; padding:14px; }
    .bar-wrap { background:#111; border-radius:3px; height:6px; overflow:hidden; flex:1; }
    .bar-fill { height:100%; border-radius:3px; transition:width 0.5s; }
    .stat-row { display:flex; gap:6px; align-items:center; margin-bottom:5px; }
    .stat-label { font-size:10px; width:22px; }
    .stat-val { font-size:10px; width:55px; text-align:right; }
    .card { background:#16213e; border:2px solid #4a4e8c; border-radius:8px; padding:10px 12px; cursor:pointer; transition:all 0.2s; }
    .card:hover { border-color:#f0c040; }
    .roster { display:grid; grid-template-columns:repeat(auto-fill,minmax(230px,1fr)); gap:8px; }
    .map-wrap { display:grid; grid-template-columns:1fr 220px; gap:10px; }
    .inspector { background:#16213e; border:2px solid #4a4e8c; border-radius:8px; padding:12px; }
    .issue-row { display:flex; align-items:center; gap:6px; background:#0f0f1b; border-radius:4px; padding:4px 8px; font-size:10px; margin-bottom:3px; }
    .badge { color:#fff; padding:1px 5px; border-radius:8px; font-size:9px; text-align:center; }
    .loading { min-height:100vh; display:flex; align-items:center; justify-content:center; flex-direction:column; gap:8px; }
    .log-box { background:#0f0f1b; padding:12px; border-radius:8px; max-height:200px; overflow-y:auto; text-align:left; min-width:320px; }
    .log-line { color:#29adff; font-size:10px; margin-bottom:2px; }
    ::-webkit-scrollbar { width:4px; } ::-webkit-scrollbar-track { background:#111; } ::-webkit-scrollbar-thumb { background:#4a4e8c; border-radius:2px; }
  </style>
</head>
<body>

<div id="app">
  <div class="loading">
    <div style="font-size:48px">âš”ï¸</div>
    <div style="color:#f0c040;font-size:18px;letter-spacing:3px">JIRA QUEST</div>
    <div style="color:#566c86;font-size:12px">Connecting to Bumrungrad Sprint...</div>
    <div class="log-box" id="logBox"></div>
  </div>
</div>

<script>
const BOARD_ID = 124;
const PROXY = '/.netlify/functions/jira'; // relative â€” same origin, no CORS!

const STATUS_COLORS = {
  'To Do':'#566c86','In Progress':'#f0a030','In Review':'#9b59b6',
  'Code Review':'#9b59b6','Done':'#38b764','Blocked':'#e43b44',
  'Selected for Development':'#3b7fd4'
};
const ROLES = ['Warrior','Mage','Ranger','Healer','Rogue','Paladin','Bard','Druid'];
const AVATARS = ['âš”ï¸','ğŸ§™','ğŸ¹','âœ¨','ğŸ—¡ï¸','ğŸ›¡ï¸','ğŸµ','ğŸŒ¿','ğŸ”¥','ğŸ’','ğŸŒ™','âš¡'];
const MCOLORS = ['#9b59b6','#e43b44','#38b764','#29adff','#f0c040','#f0a030','#e91e8c','#00bcd4'];
const ZONES = [
  { name:'Feature Forest',  color:'#1a4a2a', border:'#38b764', icon:'ğŸŒ²', match:['in progress'] },
  { name:'Review Citadel',  color:'#2a1a3a', border:'#9b59b6', icon:'ğŸ°', match:['review'] },
  { name:'Bug Dungeon',     color:'#2a1a1a', border:'#e43b44', icon:'ğŸ•·ï¸', match:['blocked'] },
  { name:'Victory Plains',  color:'#2a2a1a', border:'#f0c040', icon:'ğŸ†', match:['done'] },
  { name:'Idle Town',       color:'#1a1a2a', border:'#566c86', icon:'ğŸ˜ï¸', match:['to do','backlog','open','selected'] },
];
const ZONE_LAYOUT = [{x:5,y:5,w:42,h:42},{x:54,y:5,w:42,h:42},{x:5,y:54,w:28,h:42},{x:36,y:54,w:28,h:42},{x:67,y:54,w:28,h:42}];

let state = { team:[], issues:[], sprintName:'', tab:'map', selected:null, tick:0, lastSync:null };
let mcache = {};

const sColor = s => STATUS_COLORS[s] || '#566c86';
const getZone = s => ZONES.find(z => z.match.some(m => (s||'').toLowerCase().includes(m)))?.name || 'Idle Town';
const getMI = id => {
  if (mcache[id]) return mcache[id];
  const i = Object.keys(mcache).length;
  mcache[id] = { role:ROLES[i%ROLES.length], avatar:AVATARS[i%AVATARS.length], color:MCOLORS[i%MCOLORS.length], hp:60+((i*17)%40), mp:40+((i*23)%60) };
  return mcache[id];
};

function log(msg) {
  const box = document.getElementById('logBox');
  if (!box) return;
  const d = document.createElement('div');
  d.className = 'log-line'; d.textContent = msg;
  box.appendChild(d); box.scrollTop = box.scrollHeight;
}

async function jiraFetch(path) {
  const url = `${PROXY}?path=${encodeURIComponent(path)}`;
  const res = await fetch(url);
  if (!res.ok) throw new Error(`Proxy ${res.status}: ${await res.text()}`);
  return res.json();
}

async function fetchData() {
  try {
    log('ğŸ”„ Fetching active sprint...');
    const sd = await jiraFetch(`/rest/agile/1.0/board/${BOARD_ID}/sprint?state=active`);
    const sprint = sd.values?.[0];
    if (!sprint) throw new Error('No active sprint on board ' + BOARD_ID);
    state.sprintName = sprint.name;
    log(`âœ… Sprint: ${sprint.name}`);

    log('ğŸ”„ Fetching issues...');
    const id = await jiraFetch(`/rest/agile/1.0/board/${BOARD_ID}/sprint/${sprint.id}/issue?maxResults=100&fields=summary,assignee,status,customfield_10016,priority`);
    const raw = id.issues || [];
    log(`âœ… ${raw.length} issues loaded`);

    state.issues = raw.map(i => ({
      key:i.key, summary:i.fields?.summary||'',
      status:i.fields?.status?.name||'To Do',
      assigneeId:i.fields?.assignee?.accountId||null,
      assigneeName:i.fields?.assignee?.displayName||'Unassigned',
      points:i.fields?.customfield_10016||0,
    }));

    const am = {};
    raw.forEach(i => {
      const a = i.fields?.assignee; if (!a) return;
      if (!am[a.accountId]) am[a.accountId] = { accountId:a.accountId, name:a.displayName, issues:[] };
      am[a.accountId].issues.push({ key:i.key, summary:i.fields?.summary, status:i.fields?.status?.name||'To Do', points:i.fields?.customfield_10016||0 });
    });

    state.team = Object.values(am).map(mb => {
      const info = getMI(mb.accountId);
      const cp = mb.issues.filter(i=>i.status==='Done').reduce((s,i)=>s+(i.points||0),0);
      const xp = cp*100, level = Math.max(1,Math.floor(xp/500)+1);
      const active = mb.issues.find(i=>i.status==='In Progress') || mb.issues.find(i=>i.status==='In Review') || mb.issues.find(i=>!['Done','To Do','Backlog','Selected for Development'].includes(i.status));
      const ps = active ? active.status : mb.issues.every(i=>i.status==='Done') ? 'Done' : 'To Do';
      return { ...mb, ...info, level, xp:xp%500, issueCount:mb.issues.length, completedPts:cp, status:ps, zone:getZone(ps) };
    });

    state.lastSync = new Date();
    log(`âœ… ${state.team.length} heroes ready!`);
    render();
  } catch(e) {
    log('âŒ ' + e.message);
    renderError(e.message);
  }
}

// â”€â”€ RENDER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

function renderError(msg) {
  document.getElementById('app').innerHTML = `
    <div class="loading">
      <div style="font-size:40px">ğŸ’€</div>
      <div style="color:#e43b44;font-size:15px;margin:8px 0">CONNECTION FAILED</div>
      <div style="background:#0f0f1b;padding:12px;border-radius:8px;font-size:10px;color:#566c86;max-width:480px;line-height:1.7">${msg}</div>
      <button onclick="location.reload()" style="margin-top:12px;background:#f0c040;color:#1a1c2c;border:none;padding:8px 24px;border-radius:6px;font-weight:bold;font-size:12px">âš¡ Retry</button>
    </div>`;
}

function statBar(val, max, color, h=6) {
  const pct = Math.min(100, max>0 ? (val/max)*100 : 0);
  return `<div class="bar-wrap" style="height:${h}px"><div class="bar-fill" style="width:${pct}%;background:${color}"></div></div>`;
}

function renderMap() {
  const zoneCount = ZONES.map(z => `
    <div style="display:flex;align-items:center;gap:4px;font-size:10px;color:#566c86">
      <div style="width:8px;height:8px;background:${z.border};border-radius:2px"></div>
      ${z.icon} ${z.name} (${state.team.filter(m=>m.zone===z.name).length})
    </div>`).join('');

  const inspector = state.selected ? `
    <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
      <div style="font-size:36px">${state.selected.avatar}</div>
      <div>
        <div style="color:${state.selected.color};font-size:14px;font-weight:bold">${state.selected.name}</div>
        <div style="color:#566c86;font-size:10px">${state.selected.role} Â· Lv.${state.selected.level}</div>
        <span class="badge" style="background:${sColor(state.selected.status)}">${(state.selected.status||'').toUpperCase()}</span>
      </div>
    </div>
    <div style="background:#0f0f1b;border-radius:6px;padding:8px;margin-bottom:8px;font-size:10px">
      <div style="color:#566c86;margin-bottom:4px">ğŸ“‹ QUESTS (${state.selected.issues?.length||0})</div>
      ${(state.selected.issues||[]).slice(0,4).map(i=>`
        <div style="color:#f4f4f4;margin-bottom:3px;border-left:2px solid ${sColor(i.status)};padding-left:6px">
          <span style="color:#566c86">${i.key}</span> Â· ${(i.summary||'').slice(0,24)}
          <span style="float:right;color:#f0c040">${i.points||'?'}pt</span>
        </div>`).join('')}
      <div style="color:#29adff;margin-top:4px">ğŸ“ ${state.selected.zone}</div>
    </div>
    ${[['HP',state.selected.hp,100,'#e43b44'],['MP',state.selected.mp,100,'#3b7fd4'],['XP',state.selected.xp,500,'#f0c040']].map(([l,v,m,c])=>`
      <div class="stat-row">
        <span class="stat-label" style="color:${c}">${l}</span>
        ${statBar(v,m,c,8)}
        <span class="stat-val" style="color:${c}">${v}/${m}</span>
      </div>`).join('')}
  ` : `<div style="color:#566c86;font-size:11px;padding:20px;text-align:center">â†‘ Click a hero on the map</div>`;

  return `
    <div class="map-wrap">
      <div>
        <canvas id="mapCanvas" width="640" height="360"></canvas>
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">${zoneCount}</div>
      </div>
      <div class="inspector">
        <div style="color:#f0c040;font-size:11px;font-weight:bold;margin-bottom:8px">ğŸ” INSPECTOR</div>
        ${inspector}
      </div>
    </div>`;
}

function renderRoster() {
  return `<div class="roster">${state.team.map(m => `
    <div class="card" onclick="selectMember('${m.accountId}')" style="border-color:${state.selected?.accountId===m.accountId?m.color:'#4a4e8c'}">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px">
        <span style="font-size:22px">${m.avatar}</span>
        <div>
          <div style="color:${m.color};font-weight:bold;font-size:13px">${m.name}</div>
          <div style="color:#566c86;font-size:10px">${m.role} Â· Lv.${m.level}</div>
        </div>
        <span class="badge" style="background:${sColor(m.status)};margin-left:auto">${(m.status||'').toUpperCase()}</span>
      </div>
      <div style="font-size:10px;color:#566c86;margin-bottom:6px">${m.issueCount} quests Â· ${m.completedPts}pt done</div>
      ${[['HP',m.hp,100,'#e43b44'],['MP',m.mp,100,'#3b7fd4'],['XP',m.xp,500,'#f0c040']].map(([l,v,mx,c])=>`
        <div style="display:flex;gap:4px;align-items:center;margin-bottom:3px">
          <span style="font-size:9px;color:${c};width:18px">${l}</span>
          ${statBar(v,mx,c,5)}
          <span style="font-size:9px;color:${c}">${v}</span>
        </div>`).join('')}
    </div>`).join('')}</div>`;
}

function renderSprint() {
  const issues = state.issues;
  const total = issues.reduce((s,i)=>s+(i.points||0),0);
  const done = issues.filter(i=>i.status==='Done').reduce((s,i)=>s+(i.points||0),0);
  const inprog = issues.filter(i=>i.status==='In Progress').reduce((s,i)=>s+(i.points||0),0);
  const rev = issues.filter(i=>['In Review','Code Review'].includes(i.status)).reduce((s,i)=>s+(i.points||0),0);
  const todo = total-done-rev-inprog;
  const pct = total>0?Math.round((done/total)*100):0;
  const segs = [{l:'Done',v:done,c:'#38b764'},{l:'Review',v:rev,c:'#9b59b6'},{l:'In Progress',v:inprog,c:'#f0a030'},{l:'To Do',v:todo,c:'#566c86'}];

  return `
    <div class="panel">
      <div style="display:flex;justify-content:space-between;margin-bottom:6px">
        <span style="color:#f0c040;font-size:12px;font-weight:bold">âš”ï¸ ${state.sprintName}</span>
        <span style="color:#f0c040;font-size:12px">${done}/${total} pts Â· ${pct}%</span>
      </div>
      <div style="height:20px;display:flex;border-radius:6px;overflow:hidden;border:1px solid #4a4e8c;margin-bottom:8px">
        ${segs.filter(s=>s.v>0).map(s=>`<div style="width:${total>0?(s.v/total)*100:0}%;background:${s.c}" title="${s.l}: ${s.v}pts"></div>`).join('')}
      </div>
      <div style="display:flex;gap:12px;flex-wrap:wrap;margin-bottom:10px">
        ${segs.map(s=>`<div style="display:flex;align-items:center;gap:4px"><div style="width:10px;height:10px;background:${s.c};border-radius:2px"></div><span style="color:#566c86;font-size:10px">${s.l}: ${s.v}pt</span></div>`).join('')}
      </div>
      <div style="display:flex;flex-direction:column;gap:3px;max-height:420px;overflow-y:auto">
        ${issues.map(issue => {
          const mb = state.team.find(m=>m.accountId===issue.assigneeId);
          return `<div class="issue-row" style="border-left:3px solid ${sColor(issue.status)}">
            <span style="color:#566c86;width:64px;flex-shrink:0">${issue.key}</span>
            <span style="color:#f4f4f4;flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap">${issue.summary}</span>
            ${mb?`<span style="color:${mb.color};width:22px;text-align:center">${mb.avatar}</span>`:''}
            <span style="color:#f0c040;width:28px;text-align:right">${issue.points||'?'}pt</span>
            <span class="badge" style="background:${sColor(issue.status)};width:72px">${issue.status?.toUpperCase()}</span>
          </div>`;
        }).join('')}
      </div>
    </div>`;
}

function renderLeaderboard() {
  const sorted = [...state.team].sort((a,b)=>(b.level*1000+b.xp)-(a.level*1000+a.xp));
  const medals = ['ğŸ¥‡','ğŸ¥ˆ','ğŸ¥‰'];
  return `
    <div style="max-width:520px;margin:0 auto" class="panel">
      <div style="color:#f0c040;font-size:13px;font-weight:bold;margin-bottom:10px;text-align:center">ğŸ† HALL OF HEROES</div>
      ${sorted.map((m,i)=>`
        <div style="display:flex;align-items:center;gap:8px;background:${i===0?'#2a2200':'#16213e'};border:1px solid ${i===0?'#f0c040':'#4a4e8c'};border-radius:6px;padding:7px 10px;margin-bottom:5px">
          <span style="font-size:16px;width:22px">${medals[i]||'#'+(i+1)}</span>
          <span style="font-size:18px">${m.avatar}</span>
          <div style="flex:1">
            <div style="color:${m.color};font-size:12px;font-weight:bold">${m.name} <span style="color:#566c86;font-weight:normal">Â· ${m.role}</span></div>
            ${statBar(m.xp,500,'#f0c040',4)}
          </div>
          <div style="text-align:right">
            <div style="color:#f0c040;font-size:13px;font-weight:bold">Lv.${m.level}</div>
            <div style="color:#566c86;font-size:9px">${m.completedPts}pt Â· ${m.issueCount} tasks</div>
          </div>
        </div>`).join('')}
    </div>`;
}

function renderDebug() {
  return `
    <div class="panel">
      <div style="color:#f0c040;font-weight:bold;margin-bottom:8px">ğŸ”§ DEBUG</div>
      <div style="color:#566c86;font-size:10px;line-height:2">
        <div>Proxy: ${PROXY}</div>
        <div>Board: ${BOARD_ID} Â· Sprint: ${state.sprintName||'â€”'}</div>
        <div>Issues: ${state.issues.length} Â· Team: ${state.team.length}</div>
        <div>Last sync: ${state.lastSync?.toLocaleTimeString()||'â€”'}</div>
      </div>
    </div>`;
}

function render() {
  const tabs = [['map','ğŸ—ºï¸ Map'],['roster','ğŸ‘¥ Party'],['board','âš”ï¸ Sprint'],['lead','ğŸ† Ranks'],['debug','ğŸ”§ Debug']];
  const now = new Date();

  document.getElementById('app').innerHTML = `
    <div class="header">
      <div>
        <div style="color:#f0c040;font-size:18px;font-weight:bold;letter-spacing:2px">âš”ï¸ JIRA QUEST</div>
        <div style="color:#566c86;font-size:10px">BUM Â· ${state.sprintName} Â· ${state.team.length} Heroes</div>
      </div>
      <div style="display:flex;align-items:center;gap:12px">
        ${state.lastSync?`<div style="text-align:center"><div style="color:#38b764;font-size:9px">ğŸŸ¢ LIVE</div><div style="color:#566c86;font-size:8px">${state.lastSync.toLocaleTimeString()}</div></div>`:''}
        <button onclick="fetchData()" style="background:#16213e;color:#29adff;border:1px solid #29adff;border-radius:6px;padding:4px 10px;font-size:10px">âŸ³ Sync</button>
        <div style="text-align:right">
          <div style="color:#29adff;font-size:13px">${now.toLocaleTimeString()}</div>
          <div style="color:#566c86;font-size:9px">${now.toLocaleDateString()}</div>
        </div>
      </div>
    </div>
    <div class="tabs">
      ${tabs.map(([k,l])=>`<button class="tab ${state.tab===k?'active':''}" onclick="setTab('${k}')">${l}</button>`).join('')}
    </div>
    <div id="content">
      ${state.tab==='map' ? renderMap() :
        state.tab==='roster' ? renderRoster() :
        state.tab==='board' ? renderSprint() :
        state.tab==='lead' ? renderLeaderboard() :
        renderDebug()}
    </div>
    <div style="margin-top:10px;text-align:center;color:#566c86;font-size:9px">
      âš¡ JIRA QUEST Â· ${state.sprintName} Â· Live via Netlify Â· ${state.issues.length} issues
    </div>`;

  if (state.tab === 'map') drawMap();
}

function setTab(t) { state.tab = t; state.selected = null; render(); }

function selectMember(id) {
  state.selected = state.team.find(m=>m.accountId===id) || null;
  render();
}

// â”€â”€ CANVAS MAP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let animFrame = null;
function drawMap() {
  const canvas = document.getElementById('mapCanvas');
  if (!canvas) return;

  canvas.onclick = e => {
    const r = canvas.getBoundingClientRect();
    const sx = canvas.width/r.width, sy = canvas.height/r.height;
    const mx = (e.clientX-r.left)*sx, my = (e.clientY-r.top)*sy;
    const W=canvas.width, H=canvas.height;
    let hit = null;
    ZONES.forEach((z,zi)=>{
      const l=ZONE_LAYOUT[zi], zx=l.x/100*W, zy=l.y/100*H;
      state.team.filter(m=>m.zone===z.name).forEach((m,mi)=>{
        const col=mi%3, row=Math.floor(mi/3);
        if(Math.hypot(mx-(zx+20+col*44), my-(zy+32+row*34))<18) hit=m;
      });
    });
    state.selected = hit;
    render();
  };

  if (animFrame) cancelAnimationFrame(animFrame);
  let tick = 0;
  function frame() {
    if (!document.getElementById('mapCanvas')) return;
    tick++;
    const ctx = canvas.getContext('2d');
    const W=canvas.width, H=canvas.height;
    ctx.fillStyle='#0d1117'; ctx.fillRect(0,0,W,H);
    ctx.strokeStyle='#1a2030'; ctx.lineWidth=1;
    for(let x=0;x<W;x+=20){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,H);ctx.stroke();}
    for(let y=0;y<H;y+=20){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(W,y);ctx.stroke();}

    ZONES.forEach((z,zi)=>{
      const l=ZONE_LAYOUT[zi], zx=l.x/100*W, zy=l.y/100*H, zw=l.w/100*W, zh=l.h/100*H;
      ctx.fillStyle=z.color; ctx.strokeStyle=z.border; ctx.lineWidth=2;
      ctx.beginPath(); ctx.roundRect(zx,zy,zw,zh,8); ctx.fill(); ctx.stroke();
      ctx.fillStyle=z.border; ctx.font='bold 10px monospace';
      ctx.fillText(`${z.icon} ${z.name}`,zx+6,zy+16);

      state.team.filter(m=>m.zone===z.name).forEach((m,mi)=>{
        const col=mi%3, row=Math.floor(mi/3);
        const wobble = tick%2===0?1.2:-1.2;
        const mx=zx+20+col*44+wobble, my=zy+32+row*34;
        const isSel = state.selected?.accountId===m.accountId;
        if(isSel){ctx.shadowColor=m.color;ctx.shadowBlur=14;}
        ctx.fillStyle=isSel?m.color:m.color+'bb';
        ctx.beginPath();ctx.arc(mx,my,isSel?13:10,0,Math.PI*2);ctx.fill();
        ctx.shadowBlur=0;
        ctx.font=`${isSel?15:12}px serif`;ctx.textAlign='center';
        ctx.fillText(m.avatar,mx,my+5);
        ctx.fillStyle=isSel?'#fff':'#ccc';ctx.font=`bold ${isSel?9:8}px monospace`;
        ctx.fillText(m.name.split(' ')[0],mx,my+24);
        ctx.fillStyle=sColor(m.status);
        ctx.beginPath();ctx.arc(mx+9,my-9,4,0,Math.PI*2);ctx.fill();
      });
    });
    animFrame = setTimeout(frame, 700);
  }
  frame();
}

// â”€â”€ CLOCK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
setInterval(()=>{
  const el=document.querySelector('.header div:last-child div:first-child');
  if(el) el.textContent=new Date().toLocaleTimeString();
},1000);

// â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
fetchData();
setInterval(fetchData, 60000);
</script>
</body>
</html>
